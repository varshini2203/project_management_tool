{% extends "base.html" %}
{% block content %}
<div class="row">
  <div class="col-lg-8 mb-4">
    <div class="glass-card p-4">
      <div class="d-flex justify-content-between align-items-start mb-3">
        <div>
          <h3 class="mb-1">{{ task.title }}</h3>
          <p class="mb-1 text-muted">
            In list: <span class="badge bg-secondary">{{ task.task_list.title }}</span>
          </p>
          {% if task.due_date %}
            <p class="mb-0"><span class="badge bg-warning text-dark">
              Due: {{ task.due_date }}</span>
            </p>
          {% endif %}
        </div>
        <a href="{% url 'project_detail' task.task_list.project.id %}"
           class="btn gradient-outline-btn btn-sm">
          ← Back to board
        </a>
      </div>

      <form method="post" class="mt-3">
        {% csrf_token %}
        <input type="hidden" name="save_task" value="1">
        <div class="mb-3">
          <label class="form-label">Title</label>
          <input type="text" name="title" class="form-control"
                 value="{{ task.title }}">
        </div>
        <div class="mb-3">
          <label class="form-label">Description</label>
          <textarea name="description" class="form-control" rows="4"
                    placeholder="Add task details, steps, links…">{{ task.description }}</textarea>
        </div>
        <div class="mb-3 col-md-6">
          <label class="form-label">Due date</label>
          <input type="date" name="due_date" class="form-control"
                 value="{{ task.due_date|date:'Y-m-d' }}">
        </div>
        <button type="submit" class="btn gradient-btn">
          Save task
        </button>
      </form>
    </div>
  </div>

  <div class="col-lg-4">
    <div class="glass-card mb-4 p-3">
      <h5 class="mb-3">Activity</h5>
      <div style="max-height: 320px; overflow-y:auto;">
        <ul class="list-group list-group-flush">
          {% for comment in comments %}
            <li class="list-group-item bg-transparent text-light border-secondary">
              <div class="d-flex justify-content-between">
                <strong>{{ comment.author.username }}</strong>
                <small class="text-muted">
                  {{ comment.created_at|date:"M d, Y H:i" }}
                </small>
              </div>
              <div class="mt-1">{{ comment.text }}</div>
            </li>
          {% empty %}
            <li class="list-group-item bg-transparent text-muted border-secondary">
              No comments yet. Start the discussion below.
            </li>
          {% endfor %}
        </ul>
      </div>
    </div>

    <div class="glass-card p-3">
      <h5 class="mb-3">Add comment</h5>
      <form method="post">
        {% csrf_token %}
        <div class="mb-3">
          <textarea name="text" class="form-control" rows="2"
                    placeholder="Write a comment…"></textarea>
        </div>
        <button type="submit" class="btn gradient-btn w-100">
          Post comment
        </button>
      </form>
    </div>
  </div>
</div>
{% endblock %}
